"use strict";"require form";"require poll";"require uci";"require view";
document.head.append(E('style',{'type':'text/css'},`:root {--app-id-font-color: #454545;--app-id-font-shadow: #fff;--app-id-connected-color: #6bdebb;--app-id-disconnected-color: #f8aeba;--app-id-undefined-color: #dfdfdf;}:root[data-darkmode="true"] {--app-id-font-color: #f6f6f6;--app-id-font-shadow: #4d4d4d;--app-id-connected-color: #005F20;--app-id-disconnected-color: #a93734;--app-id-undefined-color: #4d4d4d;}.id-connected {--on-color: var(--app-id-font-color);background-color: var(--app-id-connected-color) !important;border-color: var(--app-id-connected-color) !important;color: var(--app-id-font-color) !important;text-shadow: 0 1px 1px var(--app-id-font-shadow);}.id-disconnected {--on-color: var(--app-id-font-color);background-color: var(--app-id-disconnected-color) !important;border-color: var(--app-id-disconnected-color) !important;color: var(--app-id-font-color) !important;text-shadow: 0 1px 1px var(--app-id-font-shadow);}.id-undefined {--on-color: var(--app-id-font-color);background-color: var(--app-id-undefined-color) !important;border-color: var(--app-id-undefined-color) !important;color: var(--app-id-font-color) !important;text-shadow: 0 1px 1px var(--app-id-font-shadow);}.id-label-status {display: inline-block;word-wrap: break-word;margin: 2px !important;padding: 4px 8px;border: 1px solid;-webkit-border-radius: 4px;-moz-border-radius: 4px;border-radius: 4px;font-weight: bold;}`));
async function updateStatus() {await fetch('/cgi-bin/luci/admin/services/acmt/uhttpd_status').then(res => res.json()).then(data => {const el = document.getElementById('uhttpd_status');if (!el) return;if (data.running === true) {el.innerHTML = `<p class="id-label-status id-connected"><span class="id-connected"><i>uHTTPd RUNNING ${data.pid}</i></span></p>`;} else {el.innerHTML = `<p class="id-label-status id-disconnected"><span class="id-disconnected"><i>uHTTPd NOT RUNNING</i></span></p>`;}}).catch(() => {const el = document.getElementById('uhttpd_status');if (el) el.innerHTML = `<p class="id-label-status id-undefined"><span class="id-undefined"><i>Failed to retrieve status</i></span></p>`;});}
return view.extend({load: function () {return Promise.all([uci.load("uhttpd"),updateStatus()]);},render: function (data) {let m,s,o;const cfg = data[0];const statusData = data[1];m = new form.Map('uhttpd', _('uHTTPd Web Server'), _('Manage uHTTPd instances with custom settings.'));s = m.section(form.TypedSection, '_status', _('Status'));s.anonymous = true;s.render = function () {return E('div', { class: 'cbi-section' }, [E('div', { id: 'uhttpd_status' }, [E('p', { class: 'id-label-status id-undefined' }, [E('img', { src: '/luci-static/resources/view/acmt/img/loading.gif', style: 'width:14px; height:14px; vertical-align:middle; margin-right:5px;'}),E('span', { class: 'id-undefined' }, [E('i', _('Collecting data ...'))])])])]);};s = m.section(form.TypedSection, 'uhttpd', _(''));s.anonymous = false;s.addremove = true;s.tab('general', _('General Settings'));s.tab('advanced', _('Advanced Settings'));s.tab('extra', _('Extra Settings'));o = s.taboption('general', form.Flag, 'enabled', _('Enabled'));o.default = '1';o.rmempty = false;o = s.taboption('general', form.Flag, 'redirect_https', _('Redirect HTTP to HTTPS'));o.default = '0';o.rmempty = false;o = s.taboption('general', form.Flag, 'rfc1918_filter', _('Block RFC1918 clients'));o.default = '1';o.rmempty = false;o = s.taboption('general', form.Flag, 'no_dirlists', _('No Directory Lists'));o.default = '1';o.rmempty = false;o = s.taboption('general', form.Value, 'home', _('Home Directory'));o.default = '/www';o.rmempty = false;o = s.taboption('general', form.DynamicList, 'listen_http', _('Listen HTTP'));o.rmempty = false;o = s.taboption('general', form.DynamicList, 'listen_https', _('Listen HTTPS'));o.rmempty = false;o = s.taboption('general', form.DynamicList, 'index_page', _('Index Pages'));o.default = ['index.html','index.php'];o = s.taboption('advanced', form.Value, 'cgi_prefix', _('CGI Prefix'));o = s.taboption('advanced', form.DynamicList, 'lua_prefix', _('Lua Prefix'));o = s.taboption('advanced', form.Value, 'max_requests', _('Max Requests'));o.default = '50';o = s.taboption('advanced', form.Value, 'max_connections', _('Max Connections'));o.default = '100';o = s.taboption('advanced', form.Value, 'script_timeout', _('Script Timeout (s)'));o.default = '3600';o = s.taboption('advanced', form.Value, 'network_timeout', _('Network Timeout (s)'));o.default = '30';o = s.taboption('advanced', form.Value, 'http_keepalive', _('HTTP Keepalive (s)'));o.default = '20';o = s.taboption('advanced', form.Flag, 'tcp_keepalive', _('TCP Keepalive'));o.default = '1';o = s.taboption('advanced', form.Value, 'ubus_prefix', _('Ubus Prefix'));o = s.taboption('advanced', form.Value, 'interpreter', _('Interpreter Mapping'));o.default = '.php=/usr/bin/php-cgi';o = s.taboption('extra', form.Value, 'cert', _('SSL Certificate Path'));o = s.taboption('extra', form.Value, 'key', _('SSL Private Key Path'));o = s.taboption('extra', form.Value, 'error_page', _('Error Pages'));o = s.taboption('extra', form.DynamicList, 'ucode_prefix', _('uCode Prefix'));poll.add(function () {updateStatus();});return m.render();}});